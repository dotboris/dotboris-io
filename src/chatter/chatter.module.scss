@import "../values.scss";

.chatter {
  display: grid;
  grid: auto / auto 1fr;
  align-items: end;

  // Because of the scrolling nonsense for the bubbles we need to take up the
  // size of the parent.
  height: 100%;

  button {
    all: unset;

    &,
    .avatar {
      border-radius: 100%;
    }

    .avatar {
      border: transparent 3px solid;
      outline: $white 3px solid;
    }

    &:hover {
      cursor: pointer;

      .avatar {
        outline-color: pink;
      }
    }
  }


  .bubbles-wrapper {
    $padding: 1rem;

    position: relative;
    box-sizing: border-box;
    height: 100%;

    // By default grid items have these set to `auto`. This lets them take up
    // the space they need as they grow. In our case, we don't want them cell to
    // grow. The inner element will do the growing with scrolling.
    min-width: 0;
    min-height: 0;

    .fade {
      content: "";
      width: 100%;
      height: $padding;
      position: absolute;
      left: 0;

      &.fade-top {
        background-image: linear-gradient($black, transparent);
        top: 0;
      }

      &.fade-bottom {
        background-image: linear-gradient(transparent, $black);
        bottom: 0;
      }
    }

    ul,
    li {
      // clean up all the <ul> an <li> default styles
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .bubbles {
      // The direction is reversed so stuff like :first-child and :last-child are
      // inversed as well.
      display: flex;
      flex-direction: column-reverse;
      align-items: start;

      overflow-y: auto;
      box-sizing: border-box;
      height: 100%;
      padding: $padding 0 $padding $padding;

      // Spacing between flex elements
      >* {
        margin: 0.25rem 0 0 0;

        &:last-child {
          margin: 0;
        }
      }

      >* {
        // Individual bubble
        $radius: 0.5rem;

        position: relative;
        border-radius: $radius;
        padding: 0.25rem 0.5rem;
        background: $white;
        color: $black;

        &:first-child {
          // Only the last child has a swoosh
          border-radius: $radius $radius $radius 0;

          &::before {
            // Swoosh or arrow that makes this a speech bubble.
            // It's built with CSS and plenty of jank reader beware.
            position: absolute;

            $box-size: 1rem;
            $arrow-width: 0.5rem;
            $arrow-height: 1rem;

            // Make this pseudo-element a box and put it to the left of the bubble
            // aligned with the bottom of the bubble
            content: "";
            left: -$box-size;
            bottom: 0;
            width: $box-size;
            height: $box-size;


            // Give it a radius that's the inverse of the shape you want. We're
            // using this to "cut" out the value of the box. (I did promise jank)
            border-bottom-right-radius: $arrow-width $arrow-height;

            // The box itself is transparent but it's box shadow is not giving us a
            // sort of inverted rectangle shape where the actual box with the radius
            // is cut out and the swoosh is left behind.
            background-color: transparent;
            box-shadow: $arrow-width 0 0 0 $white;
          }
        }
      }
    }
  }
}
